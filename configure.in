dnl Process this file with autoconf to produce a configure script.
AC_INIT(configure.in)

AC_LANG(C)

dnl progs
AC_PROG_CC

dnl info
AM_INIT_AUTOMAKE("speech-dispatcher", "`cat version.sh|grep '^VERSION'|awk -F= '{print $2}'`")

AM_CONFIG_HEADER(config.h)

dnl Checks for libraries.
AC_CHECK_LIB(m,
        sqrt,,
        echo "*** Required math library missing! See INSTALL .";exit 1)
AC_CHECK_LIB(dl,
        main,,
        echo "*** Required dl library missing! See INSTALL .";exit 1)
AC_CHECK_LIB(dotconf,
        main,,
        echo "*** Required DotConf library missing! See INSTALL .";exit 1)
AC_CHECK_LIB(glib-2.0,
        g_list_append,,
        echo "*** Required Glib-2.0 library missing! See INSTALL .";exit 1)
AC_CHECK_LIB(pthread,
        pthread_create,,
        echo "*** Required pthread library missing! See INSTALL .";exit 1)

dnl Check for Flite (currently required)
AC_CHECK_LIB(flite,
        flite_init, echo "",
        echo "*** Required Flite libraries missing or instalation incomplete! See INSTALL .";exit 1)

AC_CHECK_LIB(flite_cmulex,
        cmu_lex_init, echo "",
        echo "*** Required Flite libraries missing or instalation incomplete! See INSTALL .";exit 1,
	-lflite)

AC_CHECK_LIB(flite_usenglish,
        usenglish_init, echo "",
        echo "*** Required Flite libraries missing or instalation incomplete! See INSTALL .";exit 1,
	-lflite)

flite_basic="-lflite -lflite_cmulex -lflite_usenglish";

AC_CHECK_LIB(flite_cmu_us_kal16,
        register_cmu_us_kal, flite_kal="-lflite_cmu_us_kal16", 
        	AC_CHECK_LIB(flite_cmu_us_kal,	
        	register_cmu_us_kal, flite_libs="-lflite_cmu_us_kal", 
        	echo "*** Required Flite kal voice library missing or instalation incomplete! See INSTALL .";exit 1,
		-lflite -lflite_usenglish -lflite_cmulex),
	-lflite -lflite_usenglish -lflite_cmulex)

AC_SUBST(flite_basic)
AC_SUBST(flite_kal)

glib_include=`pkg-config --cflags glib-2.0`
AC_SUBST(glib_include)
glib_libs=`pkg-config --libs glib-2.0`
AC_SUBST(glib_libs)
spdconfdir="$sysconfdir/speech-dispatcher/" 
AC_SUBST(spdconfdir)
snddatadir="$datadir/sounds/speech-dispatcher/" 
AC_SUBST(snddatadir)
modulebindir="$bindir/speechd-modules/" 
AC_SUBST(modulebindir)
moduleconfdir="$sysconfdir/speech-dispatcher/modules/" 
AC_SUBST(moduleconfdir)

AC_ARG_VAR(pidpath, Absolute path to a pid file)

LIB_SDAUDIO_CURRENT=1
LIB_SDAUDIO_REVISION=0
LIB_SDAUDIO_AGE=0
AC_SUBST(LIB_SDAUDIO_CURRENT)
AC_SUBST(LIB_SDAUDIO_REVISION)
AC_SUBST(LIB_SDAUDIO_AGE)

LIB_SPD_CURRENT=2
LIB_SPD_REVISION=1
LIB_SPD_AGE=1
AC_SUBST(LIB_SPD_CURRENT)
AC_SUBST(LIB_SPD_REVISION)
AC_SUBST(LIB_SPD_AGE)

dnl Checks for header files.
AC_HEADER_STDC
AC_CHECK_HEADERS(limits.h sys/ioctl.h sys/time.h unistd.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_HEADER_TIME

dnl Checks for library functions.
AC_PROG_GCC_TRADITIONAL
AC_CHECK_FUNCS(select socket)

AC_PROG_INSTALL
AC_PROG_MAKE_SET

AM_PROG_LIBTOOL

AC_OUTPUT([Makefile src/Makefile src/server/Makefile src/modules/Makefile src/c/Makefile src/c/api/Makefile src/c/clients/Makefile src/c/clients/say/Makefile src/tests/Makefile src/audio/Makefile config/Makefile config/modules/Makefile config/clients/Makefile doc/Makefile])

